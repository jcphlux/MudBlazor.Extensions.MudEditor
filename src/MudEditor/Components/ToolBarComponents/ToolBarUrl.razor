@inherits ToolBarBase
@inject IDialogService _dialogService
@namespace MudBlazor.Extensions.ToolBarComponents
<MudIconButton Color="@(Active? Editor.ToolBarActiveColor: Editor.ToolBarColor)" Icon="@Action.Icon" OnClick="Open" Size="Size.Small" Title="@Action.Label" Variant="@Editor.ToolBarVariant"></MudIconButton>

@code {
    private readonly DialogOptions _dialogOptions = new() { NoHeader = true };

    private async Task Open() {
        var url = (Value as string) ?? "";
        var parameters = new DialogParameters {
            {"Url", url},
            {"Icon", Action.Icon},
            {"Label", Action.Label},
            {"Variant", Editor.ToolBarVariant},
            {"Update", !string.IsNullOrEmpty(url)}
        };

        var dialog = _dialogService.Show<ToolBarUrlDialog>(Action.Label, parameters, _dialogOptions);
        var result = await dialog.Result;

        if (result.Cancelled) return;

        url = result.Data.ToString();
        await Editor.SetAttrib(Action.Command, Action.Attrib, url);
    }

    protected override async void OnValueChanged() {
        if (Active)
            await Open();
    }
}
